<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Onboarding</title>
</head>
<body>
  <h1>Connect Telegram</h1>
  <div id="qr">Loading...</div>
  <script>
  async function init() {
    const res = await fetch('/v1/auth/qr', {method: 'POST'});
    const data = await res.json();
    const img = document.createElement('img');
    img.src = 'data:image/png;base64,' + data.qr_png_b64;
    document.getElementById('qr').innerHTML = '';
    document.getElementById('qr').appendChild(img);
    const loginId = data.login_id;
    async function poll() {
      const r = await fetch(`/v1/auth/qr/${loginId}`);
      const d = await r.json();
      if (d.status === 'PENDING') {
        setTimeout(poll, 1000);
      } else {
        document.getElementById('qr').textContent = d.status;
      }
    }
    poll();
  }
  init();
  </script>
</body>
</html>
